# 保护模式进阶，向内核迈进

## 获取物理量内存容量

### 学习 Linux 获取内存的方法
在Linux中有多种获取内存的方法，（其中最简单的方法是使用`/proc/meminfo`文件，该文件包含了系统内存的详细信息。我们可以通过读取该文件来获取内存容量。）可以用detect_memory函数来获取内存容量。这个函数是用0x15d 中断来实现的.

分别是 BIOS 中断 0x15 的 3 个子功能，子功能号要存放到寄存器 EAX 或 AX 中，如下。
- EAX=0xE820：遍历主机上全部内存。
- AX=0xE801： 分别检测低 15MB 和 16MB～4GB 的内存，最大支持 4GB。
- AH=0x88：最多检测出 64MB 内存，实际内存超过此容量也按照 64MB 返回




## 启用内存分页机制，畅游虚拟空间

### 为什么要分页
我们现在在一直都是在内存分段下工作，如果复杂起来后，分段机制就不够了，因为分段机制总不能直接分4G一个内存给一个程序用吧，或者将内存碎片给程序。

![alt text](image-1.png)

分页机制是计算机系统中非常重要的一种内存管理技术，它的主要目的是为了提高内存的利用率和系统的性能。分页机制将内存分成若干个大小相同的页，每个页都有一个页表项，页表项中存放着该页的物理地址。这样，我们只需要一个页表，就可以管理所有的页。


如果我们内存很大，比如 4GB，那么我们就要有 4GB 的页表，这显然是不现实的。所以，我们需要分页机制，将内存分成若干个大小相同的页，每个页都有一个页表项，页表项中存放着该页的物理地址。这样，我们只需要一个页表，就可以管理所有的页。

![alt text](../poto/5/image-1.png)

## 特权级深入浅出

### 2










