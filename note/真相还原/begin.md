
```  sh
{
    # 使用 nasm 编译 mbr.S 文件
    nasm -o mbr.bin mbr.S
    # 使用 dd 命令将 mbr 文件写入 HD60.img 文件
    dd if=./mbr.bin of=/home/hanyu/bochs/HD60.img bs=512 count=1 conv=notrunc
    # 用绝对路径
}
```

在计算机启动过程中，`MBR`（Master Boot Record）和`Loader`（引导程序）是关键的组成部分，它们负责从存储设备加载操作系统。以下是它们在启动过程中的具体作用和关系：

1. MBR（主引导记录，Master Boot Record）

- MBR 是硬盘上的第一个扇区，通常位于硬盘的0柱面、0磁头、1扇区（也就是硬盘的第一个512字节）。它包含了计算机开机时的第一段代码，用于启动引导过程。

- MBR的主要组成：
    - 引导代码（Boot Code）：这是一个小型程序，通常只占446字节，负责加载并执行后续的启动代码。它从活动分区（通常是操作系统所在的分区）中加载Loader（引导程序）。

    - 分区表（Partition Table）：占64字节，包含最多4个主分区的记录，每个分区记录16字节。

    - 魔数（Signature）：占用最后的2字节（通常是0x55AA），用来标记这个扇区是一个有效的MBR。

- MBR的工作流程：

    - 计算机启动：当计算机开启时，BIOS/UEFI会读取存储设备（硬盘、SSD等）上的MBR。

    - 加载引导代码：BIOS会执行MBR中的引导代码。

    - 加载Loader：MBR中的引导代码会查找活动分区，并将该分区的Loader（引导程序）加载到内存中，交由Loader接管后续的启动流程。

2. Loader（引导程序）

- Loader 是由 MBR 加载的，它的任务是进一步加载操作系统的内核到内存，并完成启动操作系统的工作。不同的操作系统有不同的Loader（例如GRUB、LILO等是常见的Linux引导程序）。

- Loader的工作流程：

    - 加载操作系统内核：Loader负责定位并加载存储设备上操作系统的核心部分（如Linux内核、Windows内核）。

    - 设置必要的环境：Loader在加载内核之前，需要设置好必要的环境，例如内存布局、分页表、CPU模式（保护模式、长模式等）。

    - 跳转到内核：最后，Loader会将控制权交给操作系统内核，操作系统接管并启动。

- Loader的类型：

    - 一级引导程序：从MBR加载并放在分区的引导扇区里，作用是引导加载操作系统的第二阶段代码（即内核加载器）。

    - 二级引导程序：这部分代码会根据不同的操作系统和配置，选择并加载特定的内核或者其他系统文件。

- 真相还原中的作用：

    - 在“真相还原”这一上下文（可能涉及操作系统或系统引导相关的内容）中，MBR 和 Loader 是计算机启动过程中的基础组成部分：

    - MBR 负责启动硬盘上的引导程序，确保操作系统能被加载。

    - Loader 是真正负责将操作系统内核加载进内存并启动系统的关键代码。

- 总结：MBR和Loader的关系

    - MBR是引导过程的第一步，它通过包含的引导代码将Loader加载到内存中。

    - Loader则是启动过程的第二步，它加载并启动操作系统。

    - 简单来说，MBR相当于启动引导的第一阶段，而Loader是引导的第二阶段，最终负责启动操作系统。